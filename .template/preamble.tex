% ============================================================================
% GENERAL PACKAGES
% ============================================================================
\usepackage{xcolor} % colors
\usepackage{hyperref} % hyperlinks
\usepackage{xparse} % Command and environment parser
\usepackage{ragged2e} % Improved text alignment
\usepackage{paracol} % Multi columns
\usepackage{mfirstuc} % First letter capitalization
\usepackage[danish]{isodate} % Date formatting


% ============================================================================
% FONTS AND ENCODINGS
% ============================================================================
\usepackage{tgpagella}
\usepackage[T1]{fontenc}  % International characthers
\usepackage[utf8]{inputenc} % Read UTF8
% \usepackage{fontspec} % Font selection

% \setmainfont{TeX Gyre Pagella}[
% 	BoldFont = *-Bold,
% 	ItalicFont = *-Italic,
% ]
% \setsansfont{TeX Gyre Heros}


% ============================================================================
% PAGE STYLE
% ============================================================================
\usepackage[margin=1in]{geometry}
\setlength\columnsep{0.05\textwidth}

\usepackage{fancyhdr} % Fancy headers
\setlength{\headheight}{15pt}
\setlength{\headsep}{2em}  % This adds 1em of vertical space below the header

% Define custom colors
\definecolor{headercolor}{RGB}{0,0,0}
\definecolor{textgray}{RGB}{100,100,100}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\footnotesize\thepage\quad$\cdot$\quad\leftmark}
\fancyhead[RO]{\footnotesize\rightmark\quad$\cdot$\quad\thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}

% Define the style for regular pages
\fancypagestyle{main}{
	\fancyhf{} % clear all header and footer fields
	\fancyhead[LE,RO]{\thepage} % page number on left of even pages and right of odd pages
	\fancyhead[RE]{\small\MakeUppercase{\leftmark}} % chapter on right of even pages
	\fancyhead[LO]{\small\MakeUppercase{\rightmark}} % section on left of odd pages
	\renewcommand{\headrulewidth}{0pt} % remove header rule
	\renewcommand{\footrulewidth}{0pt} % remove footer rule
}

\usepackage{setspace} % Change line spacing
\setlength{\parindent}{0pt} % Remove paragraph indentation

% ============================================================================
% CHAPTER AND SECTION STYLING
% ============================================================================
\usepackage{titlesec} % modify headers
\titlespacing*{\subsubsection}{0pt}{0em}{0.5em} % Reduce spacing around subsubsection titles

\titleformat{\chapter}[display]{\vfill\filcenter\bfseries}{}{0ex}{\Huge}%
[\vfill\null\thispagestyle{empty}\clearpage]

\titlespacing{\chapter}{0pt}{0ex}{0ex}

\titleformat{\section}
{\normalfont\Large\bfseries\sffamily}
{\thesection}{1em}{}

% ============================================================================
% DIFFICULTY DISPLAY
% ============================================================================
% \newcounter{diffcount}
% \newcommand{\difficulty}[1]{%
%     \setcounter{diffcount}{#1}%
%     \ifnum\value{diffcount}>0 $\bullet$\else$\circ$\fi%
%     \ifnum\value{diffcount}>1 $\bullet$\else$\circ$\fi%
%     \ifnum\value{diffcount}>2 $\bullet$\else$\circ$\fi%
% }

% ============================================================================
% LISTS
% ============================================================================
\usepackage{enumitem} % List customisation
\setlist{partopsep=0pt, topsep=0pt} % Remove vertical spacing before


% ============================================================================
% DASHES
% ============================================================================
\usepackage{dashrule} % Dashes
\newcommand{\seprule}{\hdashrule[0pt][x]{\textwidth}{0.5pt}{1pt}} % Outputs a dashed horizontal rule to separate major recipe elements


% ============================================================================
% RECIPE
% ============================================================================
\newenvironment{recipe}{
	\columnratio{0.32, 0.68}
	\begin{paracol}{2}
		}{
	\end{paracol}
}

% Custom command for recipe header
\newcommand{\recipeheader}[1]{
	\addcontentsline{toc}{section}{#1}
	\begin{center}
		{\fontsize{24}{28}\selectfont\textbf{#1}}
		\vspace{1em}
	\end{center}
}

% Custom command for recipe description
\newcommand{\recipedesc}[1]{
	\begin{center}
		\textit{#1}
	\end{center}
}

% Custom command for recipe metadata
\newcommand{\recipemeta}[4]{
	\seprule

	\vspace*{0.0055\textheight}
	{
		\centering
		\textbf{SERVES}\hspace{0.5em}#1\hspace{2em}
		\textbf{PREP}\hspace{0.5em}#2\hspace{2em}
		\textbf{COOKING}\hspace{0.5em}#3\hspace{2em}
		\textbf{DIFFICULTY}\hspace{0.5em}#4\par
	}
	\vspace*{-0.004\textheight}

	\seprule

	\vspace*{1em}
}

\newcommand{\recipenote}[1]{
	\switchcolumn[1]

	\vspace{1em}
	{\color{textgray}\textit{#1}}
}

% ============================================================================
% INGREDIENTS
% ============================================================================
\NewDocumentCommand{\ingredient}{ m O{\BooleanFalse} }{%
  \textit{\small#1\IfBooleanT{#2}{ (valgfrit)}}%
	\par\vspace{0.01\textheight}%
}

\NewDocumentCommand{\ingredientsection}{ m }{%
	\vspace{6pt}%
	\noindent{\textsc{\small #1}}%
	\par\noindent\rule{\linewidth}{0.4pt}%
	\vspace{2pt}%
}

\NewDocumentEnvironment{ingredients}{}{
	\switchcolumn[0]*
}{
}

% ============================================================================
% INSTRUCTIONS
% ============================================================================

\newcounter{stepnumber}
\NewDocumentCommand{\step}{ +m }{%
	\stepcounter{stepnumber}%
	\par\noindent
	\textbf{\thestepnumber.}\hspace{6pt}\ignorespaces\makefirstuc{#1}%
	\par\vspace{6pt}%
}

% Custom environment for instructions
\NewDocumentEnvironment{instructions}{}{
	\switchcolumn[1]
	\setstretch{1.1}

	\setcounter{stepnumber}{0}

	\begin{sloppypar}
		}{
	\end{sloppypar}

	\setstretch{1}
}

\NewDocumentCommand{\instructionsection}{ m }{
	\vspace{16pt}%
	\noindent\textbf{\large #1}%
	\par\noindent\rule{0.3\textwidth}{0.4pt}%
	\vspace{8pt}%
	\setcounter{stepnumber}{0}%
	\par
}
